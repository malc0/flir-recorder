#!/usr/bin/env python3

import numpy as np

ironycbcr = np.array(((16, 128, 128),
		 (20, 144, 125),
		 (21, 150, 124),
		 (22, 157, 123),
		 (24, 164, 122),
		 (25, 167, 122),
		 (27, 171, 123),
		 (28, 174, 124),
		 (30, 177, 125),
		 (31, 178, 126),
		 (33, 179, 128),
		 (35, 180, 131),
		 (37, 182, 133),
		 (40, 182, 136),
		 (42, 182, 139),
		 (44, 183, 142),
		 (46, 183, 144),
		 (48, 184, 146),
		 (49, 183, 149),
		 (51, 183, 151),
		 (52, 182, 154),
		 (54, 182, 157),
		 (56, 182, 160),
		 (58, 181, 163),
		 (60, 180, 165),
		 (61, 180, 167),
		 (63, 179, 170),
		 (64, 178, 173),
		 (66, 177, 176),
		 (67, 176, 178),
		 (69, 175, 181),
		 (70, 174, 184),
		 (71, 173, 186),
		 (73, 172, 188),
		 (74, 171, 190),
		 (75, 170, 192),
		 (76, 169, 194),
		 (77, 168, 195),
		 (78, 166, 197),
		 (80, 165, 197),
		 (81, 163, 198),
		 (82, 162, 199),
		 (84, 160, 200),
		 (86, 158, 199),
		 (87, 156, 200),
		 (89, 153, 200),
		 (91, 150, 200),
		 (93, 147, 201),
		 (94, 143, 201),
		 (96, 139, 201),
		 (98, 136, 201),
		 (100, 131, 201),
		 (102, 127, 201),
		 (104, 121, 201),
		 (105, 115, 201),
		 (106, 109, 202),
		 (107, 102, 202),
		 (108, 95, 202),
		 (110, 89, 202),
		 (112, 85, 202),
		 (114, 82, 202),
		 (115, 79, 201),
		 (117, 76, 201),
		 (119, 74, 200),
		 (121, 72, 199),
		 (123, 70, 198),
		 (124, 68, 198),
		 (126, 66, 197),
		 (128, 65, 196),
		 (130, 64, 196),
		 (132, 62, 195),
		 (133, 61, 194),
		 (135, 60, 193),
		 (137, 58, 193),
		 (139, 57, 191),
		 (142, 55, 190),
		 (144, 54, 189),
		 (146, 53, 188),
		 (148, 52, 187),
		 (150, 51, 186),
		 (152, 50, 185),
		 (153, 49, 184),
		 (155, 48, 183),
		 (158, 46, 182),
		 (161, 44, 180),
		 (163, 43, 179),
		 (166, 42, 177),
		 (168, 40, 176),
		 (170, 39, 175),
		 (171, 38, 174),
		 (174, 37, 172),
		 (175, 36, 171),
		 (178, 35, 169),
		 (180, 34, 168),
		 (182, 32, 166),
		 (183, 32, 165),
		 (185, 32, 164),
		 (187, 32, 163),
		 (189, 33, 161),
		 (191, 33, 159),
		 (193, 33, 158),
		 (195, 36, 157),
		 (198, 39, 155),
		 (200, 41, 154),
		 (202, 46, 152),
		 (205, 50, 150),
		 (207, 55, 148),
		 (210, 60, 146),
		 (212, 65, 145),
		 (214, 71, 143),
		 (217, 79, 141),
		 (219, 85, 140),
		 (221, 91, 138),
		 (224, 97, 136),
		 (225, 102, 135),
		 (227, 107, 134),
		 (229, 112, 132),
		 (231, 117, 131),
		 (233, 121, 130),
		 (234, 125, 128)), np.uint8)

iron = np.array(((0, 0, 0),
		 (0, 0, 36),
		 (0, 0, 51),
		 (0, 0, 66),
		 (0, 0, 81),
		 (2, 0, 90),
		 (4, 0, 99),
		 (7, 0, 106),
		 (11, 0, 115),
		 (14, 0, 119),
		 (20, 0, 123),
		 (27, 0, 128),
		 (33, 0, 133),
		 (41, 0, 137),
		 (48, 0, 140),
		 (55, 0, 143),
		 (61, 0, 146),
		 (66, 0, 149),
		 (72, 0, 150),
		 (78, 0, 151),
		 (84, 0, 152),
		 (91, 0, 153),
		 (97, 0, 155),
		 (104, 0, 155),
		 (110, 0, 156),
		 (115, 0, 157),
		 (122, 0, 157),
		 (128, 0, 157),
		 (134, 0, 157),
		 (139, 0, 157),
		 (146, 0, 156),
		 (152, 0, 155),
		 (157, 0, 155),
		 (162, 0, 155),
		 (167, 0, 154),
		 (171, 0, 153),
		 (175, 1, 152),
		 (178, 1, 151),
		 (182, 2, 149),
		 (185, 4, 149),
		 (188, 5, 147),
		 (191, 6, 146),
		 (193, 8, 144),
		 (195, 11, 142),
		 (198, 13, 139),
		 (201, 17, 135),
		 (203, 20, 132),
		 (206, 23, 127),
		 (208, 26, 121),
		 (210, 29, 116),
		 (212, 33, 111),
		 (214, 37, 103),
		 (217, 41, 97),
		 (219, 46, 89),
		 (221, 49, 78),
		 (223, 53, 66),
		 (224, 56, 54),
		 (226, 60, 42),
		 (228, 64, 30),
		 (229, 68, 25),
		 (231, 72, 20),
		 (232, 76, 16),
		 (234, 78, 12),
		 (235, 82, 10),
		 (236, 86, 8),
		 (237, 90, 7),
		 (238, 93, 5),
		 (239, 96, 4),
		 (240, 100, 3),
		 (241, 103, 3),
		 (241, 106, 2),
		 (242, 109, 1),
		 (243, 113, 1),
		 (244, 116, 0),
		 (244, 120, 0),
		 (245, 125, 0),
		 (246, 129, 0),
		 (247, 133, 0),
		 (248, 136, 0),
		 (248, 139, 0),
		 (249, 142, 0),
		 (249, 145, 0),
		 (250, 149, 0),
		 (251, 154, 0),
		 (252, 159, 0),
		 (253, 163, 0),
		 (253, 168, 0),
		 (253, 172, 0),
		 (254, 176, 0),
		 (254, 179, 0),
		 (254, 184, 0),
		 (254, 187, 0),
		 (254, 191, 0),
		 (254, 195, 0),
		 (254, 199, 0),
		 (254, 202, 1),
		 (254, 205, 2),
		 (254, 208, 5),
		 (254, 212, 9),
		 (254, 216, 12),
		 (255, 219, 15),
		 (255, 221, 23),
		 (255, 224, 32),
		 (255, 227, 39),
		 (255, 229, 50),
		 (255, 232, 63),
		 (255, 235, 75),
		 (255, 238, 88),
		 (255, 239, 102),
		 (255, 241, 116),
		 (255, 242, 134),
		 (255, 244, 149),
		 (255, 245, 164),
		 (255, 247, 179),
		 (255, 248, 192),
		 (255, 249, 203),
		 (255, 251, 216),
		 (255, 253, 228),
		 (255, 254, 239),
		 (255, 255, 249)), np.uint8)

def to_iron_rgb(I):	# my god this is slow
	cmin, cmax = np.percentile(I, (1, 99))
	if cmin == cmax:
		cmax = cmin + 1
	I = (I - cmin) * iron.shape[0] / (cmax - cmin)
	I[I < 0] = 0
	I[I > iron.shape[0] - 1] = iron.shape[0] - 1
	I = I.astype(np.uint8)

	return iron[I]

def to_iron_ycbcr(I):
	cmin, cmax = np.percentile(I, (1, 99))
	if cmin == cmax:
		cmax = cmin + 1
	I = (I - cmin) * ironycbcr.shape[0] / (cmax - cmin)
	I[I < 0] = 0
	I[I > ironycbcr.shape[0] - 1] = ironycbcr.shape[0] - 1
	I = I.astype(np.uint8)
	I2 = I.reshape([I.shape[0] // 2, 2, I.shape[1] // 2, 2]).sum(1).sum(2) // 4
	return ironycbcr[I, 0], ironycbcr[I2, 1], ironycbcr[I2, 2]

try:
	# use faster cython version if available
	import cmx
except ImportError:
	pass
else:
	to_iron_rgb = cmx.to_iron_rgb
	to_iron_ycbcr = cmx.to_iron_ycbcr

# vim: ts=8 sts=8 sw=8 noexpandtab
